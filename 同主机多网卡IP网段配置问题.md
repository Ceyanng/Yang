# 同主机多网卡IP网段配置问题
现在有两台主机，主机A和主机B，主机A上有两张可用网卡，主机A和B通过交换机接入同一局域网，都使用静态IPv4进行路由，探究配置同网段和不同网段会产生的结果
## 主机A两张网卡，配置不同网段ip：
|ip|iface|
|---|----|
|`70.167.7.12/16`|`eno3`|
|`90.167.9.12/16`  |`ens2f0np0`   |


### 使用局域网内的另一台主机B:
|ip|iface|
|---|----|
|`70.167.7.4`|`ens2f1`|

### B ping A：
`ping 70.167.7.12`  可以ping通   

`ping 90.167.9.12`  destination host unreachable  

### A ping B：
`ping 70.167.7.4`   可以ping通  

`ping -I 70.167.7.12  70.167.7.4` 可以ping通 *`-I <ip> `指定特定源地址*

`ping -I 90.167.9.12  70.167.7.4` destination host unreachable


### A的ARP表：

 `70.167.7.4` 的mac地址是B的ens2f1网卡mac地址（at），通过自己的eno3网卡（on） 

90.167.9.4 的mac地址<imcomplete> ，通过自己的ens2f0np0   

B也是如此

### 总结
**等价与A主机同时处于两个不同网段之中，并使用对应的网卡进行通信**   

## 主机A两张网卡，配置同网段ip
|ip|iface|
|---|----|
|`70.167.7.12/16`|`eno3`|
|`70.167.71.12/16`  |`ens2f0np0`   | 
 
### 局域网内的另一台主机B:   
|ip|iface|
|---|----|
|`70.167.7.4`|`ens2f1`|
### B ping A：
`ping 70.167.7.12` 可以ping通   

`ping 70.167.71.12` 也可以ping通   

### A ping B:
`ping 70.167.7.4` 可以ping通  

`ping -s 70.167.7.12  70.167.7.4` 可以ping通 （-I 使用的源地址）  

`ping -s 70.167.71.12  70.167.7.4` 可以ping通  

### A的路由表：
| Destination|Gateway|Genmask| Flags| Metric|Ref|use|Iface|
|------------|-------|-------|------|-------|---|---|----|
|0.0.0.0|70.167.0.1|0.0.0.0|UG|101| 0  | 0| ens2f0np0|
|0.0.0.0|70.167.0.1|0.0.0.0|UG|102| 0 | 0 | eno3|
### A的ARP表：
70.167.7.4 的mac地址是B的ens2f1网卡mac地址（at），通过自己的ens2f0np0网卡（on）  

### 分析：
**在A的视角，我要给B发信息，我不会两个网卡都用，只会用其中一个，用的是metric值更小的那个iface，即 `ens2f0np0`**   

### B的ARP表：
70.167.7.12的mac地址是B的ens2f0np0网卡的mac地址，通过自己的ens2f1   

70.167.71.12的mac地址同样是B的ens2f0np0网卡的mac地址，通过自己的ens2f1  

**在B的视角，我要给两个不同的ip发信息，但这两个ip的mac地址是同一个网卡，均是A的metric值较小的那个网卡，即 `ens2f0np0`**

### 此时拔掉eno3 
对情况网络连接状态没有任何影响，B甚至仍然可以ping 70.167.7.12
### 此时拔掉`ens2f0np0`
**B即无法ping 70.167.71.12，也无法ping70.167.7.12，即未断开连接的网卡也受到了影响**

## 总结
所以要给其分配不同的网段，这样就可以根据目的网段的不同而选择不同的网卡。  

分配在同一个网段的重要隐患在于os会自动选择后连接的同网段网卡作为默认路由的接口，并将其写在路由表中，一旦后连接的同网段网卡断开连接，在重启网络之前也无法自动恢复到之前的网卡接口。

